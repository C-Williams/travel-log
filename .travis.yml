language: python
before_install:
  - openssl aes-256-cbc -K $encrypted_3af51e426c8b_key -iv $encrypted_3af51e426c8b_iv -in publish-key.enc -out publish-key -d
  - chmod u=rw,og= ~/.ssh/publish-key
  - echo "Host github.com" >> ~/.ssh/config
  - echo "  IdentityFile ~/.ssh/publish-key" >> ~/.ssh/config
  - git --version
install:
  - pip install pytest
  - pip install geojson
  - pip install forked-path
  - npm install -g geojson-merge
before_script:
  - geojson-merge mymap.topojson class-pins.topojson > newmap.topojson
script: py.test
deploy:
  skip_cleanup: true
  provider: script
  script: bash deploy-script.sh
after_deploy:
  - bash clean-up.sh
branches:
  only:
    - master
